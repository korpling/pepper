<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Pepper: Map documents and corpora</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pepper.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Pepper
   &#160;<span id="projectnumber">3.1.0-SNAPSHOT</span>
   </div>
   <div id="projectbrief">A highly extensible plattform for conversion and manipulationoflinguisticdata.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mapping.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Map documents and corpora </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Salt differentiates between the corpus structure and the document structure. The document structure contains the primary data (data sources) and the linguistic annotations. A bunch of such information is grouped to a document (<code>SDocument</code> in Salt). The corpus structure now is a grouping mechanism to group several documents to a corpus or sub corpus (<code>SCorpus</code> in Salt). Therefore, mapping the document structure and corpus structure is the main task of a Pepper module. Normally the conceptual mapping of elements between a model or format <em>X</em> and Salt is the most tricky part. Not necessarily in a technical sense, but in a semantical. For getting a clue how the mapping can technically be realized, we strongly recommend, to read the Salt model guide and the quick user guide on <a href="http://corpus-tools.org/salt/#documentation">http://corpus-tools.org/salt/#documentation</a>.</p>
<p>There are two aspects having a big impact on the inner architecture of a Pepper module. First we have the convention over configuration aspect and second we have the aspect of parallelizing a mapping job. This results in a relatively long stack of function calls to give you an intervention option on several points. We come to this later. But if you are happy with the defaults, it is rather simple to implement your module. Again, the <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_module.html">org.corpus_tools.pepper.modules.PepperModule</a> is a singleton instance for each Pepper step, whereas there is one instance of <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_mapper.html">org.corpus_tools.pepper.modules.PepperMapper</a> per <code>SDocument</code> and <code>SCorpus</code> object in the workflow.</p>
<p>Have a look at the following snippet, which is part of each org.corpus_tools.pepper.modules.PepperModule: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;public PepperMapper createPepperMapper(Identifier identifier){</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    MyMapper mapper= new MyMapper();</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    //1: module is an im-or exporter? </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    // passing the physical location to mapper</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    mapper.setResourceURI(getIdentifier2ResourceTable()</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;          .get(identifier));</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    //2: differentiate between documents and corpora</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    if (identifier.getIdentifiableElement() </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        instanceof SDocument){</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        //do some specific stuff for documents</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    }else if (identifier.getIdentifiableElement() </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;              instanceof SCorpus){</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        //do some specific stuff for corpora</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    return(mapper);</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;}</div></div><!-- fragment --><p>This method is supposed to create a new instance of a specialized <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_mapper.html">org.corpus_tools.pepper.modules.PepperMapper</a>. Although the main initializations, necessary for the workflow (e.g. passing the customization properties, see <a class="el" href="customization.html">Customizing the mapping</a>) are done by Pepper in the back. The method is the place to make some specific configurations depending on your implementation. If your module is an im- or exporter, it might be necessary to pass the physical location of the file or folder where the Salt model is supposed to be imported from or exported to (see position 1 in code). Sometimes it might be necessary to differentiate the type of object which is supposed to be mapped (either an <code>SCorpus</code> or <code>SDocument</code> object). This is shown in the snippet under position 2.</p>
<p>That's all we have to do in <a class="el" href="classorg_1_1corpus__tools_1_1pepper_1_1impl_1_1_pepper_module_impl.html">org.corpus_tools.pepper.impl.PepperModuleImpl</a> for the mapping task, now we come to <a class="el" href="classorg_1_1corpus__tools_1_1pepper_1_1impl_1_1_pepper_mapper_impl.html">org.corpus_tools.pepper.impl.PepperMapperImpl</a>. Here you find three methods, supposed to be overwritten, as shown in the following snippet. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;public class MyMapper implements PepperMapperImpl {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    @Override</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    protected void initialize(){</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        //do some initializations</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    }</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    @Override</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    public DOCUMENT_STATUS mapSCorpus() {</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        //1: returns the resource in case that a module is </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        // an importer or exporter</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;       getResourceURI();</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;       //2: getSCorpus() returns the SCorpus object, </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;       // which for instance can be annotated</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;       getSCorpus().createSMetaAnnotation(null, &quot;author&quot;,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                   &quot;Bart Simpson&quot;);</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;       //3: returns that the process was successful</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;       return(DOCUMENT_STATUS.COMPLETED);</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    }</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    </div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    @Override</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    public DOCUMENT_STATUS mapSDocument() {</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;       //4: returns the resource in case that the module is </div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;       // an importer or exporter</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;       getResourceURI();</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;       //5: getSDocument() returns the SDocument </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;       getSDocument().setSDocumentGraph(SaltFactory.eINSTANCE</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                     .createSDocumentGraph());</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;       //6: create a primary text &quot;Is this example...&quot;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;       STextualDS primaryText= getSDocument().getSDocumentGraph()</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                .createSTextualDS(&quot;Is this example more complicated &quot;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                    + &quot;than it appears to be?&quot;);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;       //7: create a meta-annotation</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;       getSDocument().createSMetaAnnotation(null, &quot;author&quot;,</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                   &quot;Bart Simpson&quot;);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;       //8: returns that the process was successful</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;       return(DOCUMENT_STATUS.COMPLETED);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div></div><!-- fragment --><p> Not very surprising, the method 'initialize()' is invoked by the constructor and should do some initialization stuff if necessary. The methods <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_mapper.html#a330f96c1f6e15c64857bedbf536a20fe">org.corpus_tools.pepper.modules.PepperMapper.mapSCorpus()</a> and <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_mapper.html#a438e0e6ad09a8ed506f84ea9cb909bd6">org.corpus_tools.pepper.modules.PepperMapper.mapSDocument()</a> are the more interesting ones. Here is the place to implement the mapping of the corpus structure or the document structure. Note, that one instance of the mapper always processes exactly one object, so either a <code>SCorpus</code> or a <code>SDocument</code> object. If you set the physical location at position 1 in method <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_module.html#a9dc9348828cdffb97cb6f2d2633e5c14">org.corpus_tools.pepper.modules.PepperModule.createPepperMapper()</a>, you can now get that location via calling <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_mapper.html#a561327af6257024eab51862fbf15a820">org.corpus_tools.pepper.modules.PepperMapper.getResourceURI()</a> as shown at position 1 and 4. This method returns a <code>URI</code> pointing to the physical location.</p>
<blockquote class="doxtable">
<p><b>Note</b></p>
<p>If your module is an exporter, that location does not physically exist and has to be created on your own. </p>
</blockquote>
<p>Position 2 shows, how to access the current <code>SCorpus</code> object and how to annotate it for instance with a meta-annotation (in the snippet, the meta-annotation is about an author having the name 'Bart Simpson', the <code>null</code>-value means, that no namespace is used). In method <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_mapper.html#a438e0e6ad09a8ed506f84ea9cb909bd6">org.corpus_tools.pepper.modules.PepperMapper.mapSDocument()</a>, at position 5, you can access the current object (here it is of type <code>SDocument</code>) with 'getSDocument()'. If your module is an importer, you need to create a container for the document structure, a <code>SDocumentGraph</code> object. The snippet further shows the creation of a primary text at position 6. In Salt each object can be annotated or meta-annotated, so do the <code>SDocument</code> objects, as shown at position 7. Last but not least, both methods have to return a value describing whether the mapping was successful or not (see position 3 and 8). The possible results are described in <a class="el" href="enumorg_1_1corpus__tools_1_1pepper_1_1common_1_1_d_o_c_u_m_e_n_t___s_t_a_t_u_s.html">org.corpus_tools.pepper.common.DOCUMENT_STATUS</a>. Usually you only need to return the org.corpus_tools.pepper.common.DOCUMENT_STATUS.COMPLETED when everything was ok. In case of an error, Pepper will set the status org.corpus_tools.pepper.common.DOCUMENT_STATUS.FAILED automatically, as long, as the exception is thrown, which marks the document or corpus to be not processed any further.</p>
<p>During the mapping it is very helpful for the user, to give some progress status from time to time. Especially when a mapping takes a longer term, it will keep the user from a frustrating experience to have a not responding tool. More information on that can be found in <a class="el" href="feedback.html">Monitoring the progress</a>.</p>
<h2>More configuration options</h2>
<p>In a few cases, a format does not allow or only hardly allow a parallel processing. In that case you can switch-off the parallelization in your constructor with <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_module.html#a26108e6bcadd6568ead2edd51c3630ec">org.corpus_tools.pepper.modules.PepperModule.setIsMultithreaded()</a>. The Pepper framework does not directly call the method <a class="el" href="interfaceorg_1_1corpus__tools_1_1pepper_1_1modules_1_1_pepper_module.html#a9dc9348828cdffb97cb6f2d2633e5c14">org.corpus_tools.pepper.modules.PepperModule.createPepperMapper()</a>. If you need to intervene at an earlier point, you can do this at any point in the stack as shown in the following excerpt. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;/** Directly called by Pepper framework, </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    waits until a further document or corpus </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    can be processed and delegates it **/</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;@Override</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;public void start(){</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    ...</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    Identifier identifier= getModuleController().next()</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;                 .getsDocumentId();</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    start(identifier);</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    ...</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;}</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;/** Only takes control of passed document </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    or corpus and creates a mapper object per each**/</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;@Override</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;public void start(Identifier identifier){</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    ...</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    PepperMapper mapper= createPepperMapper(identifier);</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    ...</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;/** Creates and initializes a PepperMapper instance **/</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;@Override</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;public PepperMapper createPepperMapper(Identifier identifier){</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    ...</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div></div><!-- fragment --><p> Even the first two methods could be overwritten by your module, to adapt their functionality on different levels.</p>
<blockquote class="doxtable">
<p><b>Note</b></p>
<p>Take care when overriding one of them, since they handle some more functionality than explained here in this guide. To get a clue of what happens there, please take a look into the source code at <a href="https://github.com/korpling/pepper">https://github.com/korpling/pepper</a>. It might be well documented and hopefully understandable. But if questions occur, please send a mail to <a href="saltnpepper@lists.hu-berlin.de">saltnpepper@lists.hu-berlin.de</a>. </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="moduleDevelopers.html">Pepper module developers</a></li>
    <li class="footer">Generated on Wed Aug 31 2016 23:12:07 for Pepper by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
